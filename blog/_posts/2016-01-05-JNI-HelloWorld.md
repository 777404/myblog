---
layout: post
title:  "JNI笔记之一：Hello，World！"
date:   2016-01-05
---

# 测试环境
* Mac OS X 10.11
* JDK 1.8.0_60

# 第1步
创建HelloWorld.java：

```java
public class HelloWorld {
    private native void print();
    public static void main(String[] args) {
        new HelloWorld().print();
    }
    static {
        System.loadLibrary("HelloWorld");
    }
}
```

# 第2步
编译HelloWorld.java：

```shell
javac HelloWorld.java
```

# 第3步
生成jni头文件：

```shell
javah -jni HelloWorld
```

上面的命令执行完毕后，会生成HelloWorld.h：

```c
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class HelloWorld */

#ifndef _Included_HelloWorld
#define _Included_HelloWorld
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     HelloWorld
 * Method:    print
 * Signature: ()V
 */
JNIEXPORT void JNICALL Java_HelloWorld_print
  (JNIEnv *, jobject);

#ifdef __cplusplus
}
#endif
#endif
```

# 第4步
创建HelloWorld.c：

```c
#include <jni.h>
#include <stdio.h>
#include "HelloWorld.h"
 
JNIEXPORT void JNICALL 
Java_HelloWorld_print(JNIEnv *env, jobject o) {
    printf("Hello, World!\n");
    return;
}
```

# 第5步
编译HelloWorld.c，生成动态链接库：

```shell
gcc "-I/Library/Java/JavaVirtualMachines/jdk1.8.0_60.jdk/Contents/Home/include" \
    "-I/Library/Java/JavaVirtualMachines/jdk1.8.0_60.jdk/Contents/Home/include/darwin" \
    -c HelloWorld.c
gcc -dynamiclib -o libHelloWorld.dylib HelloWorld.o
```

# 第6步
运行HelloWorld程序：

```shell
java HelloWorld
```

# 参考资料
* http://docs.oracle.com/javase/8/docs/technotes/guides/jni/spec/intro.html
* http://mrjoelkemp.com/2012/01/getting-started-with-jni-and-c-on-osx-lion/
